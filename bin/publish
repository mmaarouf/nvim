#!/usr/bin/env bash
BIN_DIR="$(dirname "${BASH_SOURCE[0]}")"
source "$BIN_DIR"/dev-env/runner && run "$@"

create_release() {
    local -r tag="$1"
    gh release \
        --repo mmaarouf/nvim \
        create "$tag" out/nvim.tar.gz \
        -t "nvim $tag" \
        -n ""
}

delete_release() {
    local -r tag="$1"
    gh release \
        --repo mmaarouf/nvim \
        delete "$tag" -y --cleanup-tag || true
}

"$BIN_DIR"/build
delete_release "latest"
create_release "latest"
# create a versioned release at the end to highlight it as the "latest" in gh
create_release "v$VERSION"
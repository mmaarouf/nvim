#!/usr/bin/env bash
BIN_DIR="$(dirname "${BASH_SOURCE[0]}")"
REPO_DIR="$BIN_DIR/.."
source "$REPO_DIR"/dev-env/runner && run "$@"

create_release() {
    local -r tag="$1"
    gh release \
        --repo mmaarouf/nvim \
        create "$tag" "$REPO_DIR"/out/nvim.tar.gz \
        -t "nvim $tag" \
        -n ""
}

delete_release() {
    local -r tag="$1"
    gh release \
        --repo mmaarouf/nvim \
        delete "$tag" -y --cleanup-tag || true
}

"$BIN_DIR"/build

TAG="latest"
delete_release $TAG
create_release $TAG